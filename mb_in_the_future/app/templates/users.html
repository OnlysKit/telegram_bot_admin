<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/users.css">
</head>
<body>
    <div class="container">
        <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
        
        <div style="display: flex; gap: 15px; margin-bottom: 20px; justify-content: space-between; align-items: center;">
            {% if is_authenticated %}
                <div style="display: flex; gap: 15px;">
                    <a href="/products" class="btn" style="background-color: #16a34a; padding: 10px 20px;">üì¶ –ü—Ä–æ–¥—É–∫—Ç—ã</a>
                </div>
            {% else %}
                <div style="display: flex; gap: 15px;">
                    <span style="color: #a0a0a0; font-style: italic;">–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</span>
                </div>
                <a href="/login" class="btn login-btn" style="background-color: #4b5563; color: #a0a0a0; border: 1px solid #6b7280; padding: 10px 20px;">üîê –í–æ–π—Ç–∏</a>
            {% endif %}
        </div>
        
        {% if is_authenticated %}
            <div class="filter-section">
                <div class="filter-group">
                    <label for="bot-filter" class="filter-label">–§–∏–ª—å—Ç—Ä –ø–æ –±–æ—Ç—É:</label>
                    <select id="bot-filter" class="filter-select" onchange="filterByBot()">
                        <option value="all" {% if not selected_bot_id or selected_bot_id == 'all' %}selected{% endif %}>–í—Å–µ –±–æ—Ç—ã</option>
                        {% for bot in bots %}
                            <option value="{{ bot.bot_id }}" {% if selected_bot_id == bot.bot_id|string %}selected{% endif %}>{{ bot.title }} (@{{ bot.bot_username }})</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="stats">
                –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <span>{{ users|length }}</span>
            </div>
            
            {% if users %}
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                            <th>–ü–æ–ª–Ω–æ–µ –∏–º—è</th>
                            <th>–†–æ–ª—å</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–¢–∞—Ä–∏—Ñ</th>
                            <th>–ë–æ—Ç</th>
                            <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                            <tr>
                                <td class="user-id">{{ user.user_id }}</td>
                                <td class="username">@{{ user.username or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
                                <td>
                                    {{ user.first_name or '' }} {{ user.last_name or '' }}
                                    {% if not user.first_name and not user.last_name %}
                                        <span class="user-info">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="inline-dropdown">
                                        <select onchange='changeRole({{ user.user_id }}, this.value)' class="inline-select role-select">
                                            <option value="user" {% if not user.is_admin and not user.is_moderator %}selected{% endif %}>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                                            <option value="moderator" {% if user.is_moderator %}selected{% endif %}>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
                                            <option value="admin" {% if user.is_admin %}selected{% endif %}>–ê–¥–º–∏–Ω</option>
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    {% if user.banned %}
                                        <span class="role-badge banned">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                                    {% else %}
                                        <span class="role-badge active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="inline-dropdown">
                                        <select onchange='changeTariff({{ user.user_id }}, this.value)' class="inline-select">
                                            <option value="">–ë–µ–∑ —Ç–∞—Ä–∏—Ñ–∞</option>
                                            {% for tariff_key, tariff_data in tariffs.items() %}
                                                <option value="{{ tariff_key }}" {% if user.tariff == tariff_key %}selected{% endif %}>{{ tariff_data.title }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    <div class="inline-dropdown">
                                        <select onchange='changeBot({{ user.user_id }}, this.value)' class="inline-select">
                                            <option value="">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                                            {% for bot in bots %}
                                                <option value="{{ bot.bot_id }}" {% if user.bot_id == bot.bot_id %}selected{% endif %}>{{ bot.title }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    <span class="user-info clickable-source" onclick='openSourceModal({{ user.user_id }}, "{{ user.source or "" }}")'>
                                        {{ user.source or '–ù–µ —É–∫–∞–∑–∞–Ω' }}
                                    </span>
                                </td>
                                <td>
                                    <div class="user-actions">
                                        {% if user.banned %}
                                            <form method="POST" action="/users/{{ user.user_id }}/ban" style="display: inline;" onsubmit="return confirm('–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')">
                                                <button type="submit" class="btn btn-unban">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                                            </form>
                                        {% else %}
                                            <form method="POST" action="/users/{{ user.user_id }}/ban" style="display: inline;" onsubmit="return confirm('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')">
                                                <button type="submit" class="btn btn-ban">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                                            </form>
                                        {% endif %}
                                        
                                        
                                        <a href="/users/{{ user.user_id }}/delete" class="btn btn-delete" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')">–£–¥–∞–ª–∏—Ç—å</a>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="no-users">
                    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                </div>
            {% endif %}
        {% endif %}
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ -->
    <div id="sourceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–ò–∑–º–µ–Ω–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <span class="close" onclick="closeSourceModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="width: 100%;">
                    <input type="text" id="sourceInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-secondary" onclick="closeSourceModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-modal btn-modal-primary" onclick="saveSource()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="/static/js/users.js"></script>
</body>
</html>
