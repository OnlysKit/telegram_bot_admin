<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/products.css">
</head>
<body>
    <div class="container">
        <!-- <h1>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h1> -->
        
        <div style="display: flex; gap: 15px; margin-bottom: 20px; justify-content: space-between; align-items: center;">
            {% if is_authenticated %}
                <div style="display: flex; gap: 15px;">
                    <a href="/add-product" class="add-product-btn">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</a>
                    <a href="/add-bot" class="add-product-btn" style="background-color: #17a2b8;">+ –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞</a>
                    <a href="/users" class="add-product-btn" style="background-color: #7c3aed;">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                </div>
            {% else %}
                <div style="display: flex; gap: 15px;">
                    <span style="color: #a0a0a0; font-style: italic;">–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</span>
                </div>
                <a href="/login" class="add-product-btn login-btn">üîê –í–æ–π—Ç–∏</a>
            {% endif %}
        </div>
        
        <div class="filter-section">
            <div class="filter-group">
                <label for="bot-filter" class="filter-label">–§–∏–ª—å—Ç—Ä –ø–æ –±–æ—Ç—É:</label>
                <select id="bot-filter" class="filter-select" onchange="filterByBot()">
                    <option value="all" {% if not selected_bot_id or selected_bot_id == 'all' %}selected{% endif %}>–í—Å–µ –±–æ—Ç—ã</option>
                    {% for bot in bots %}
                        <option value="{{ bot.bot_id }}" {% if selected_bot_id == bot.bot_id|string %}selected{% endif %}>{{ bot.title }} (@{{ bot.bot_username }})</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="stats">
            –í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: <span>{{ products|length }}</span>
        </div>
        
        {% if products %}
            <div class="products-grid">
                {% for product in products %}
                    <div class="product-card" onclick="window.location.href='/edit-product/{{ product.id }}'">
                        <div class="product-title">{{ product.title }}</div>
                        {% if product.description %}
                            <div class="product-description">{{ product.description }}</div>
                        {% endif %}
                        
                        <div class="product-price">
                            {% if product.is_free %}
                                <span class="product-free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                            {% else %}
                                {% if product.price and product.price > 0 %}
                                    {% if product.discount and product.discount > 0 %}
                                        {% set final_price = product.price * (100 - product.discount) / 100 %}
                                        <span class="original-price" style="text-decoration: line-through; color: #888; margin-right: 8px;">{{ product.price }} ‚ÇΩ</span>
                                        <span class="discounted-price" style="color: #4ade80; font-weight: bold;">{{ final_price|round|int }} ‚ÇΩ</span>
                                        <span class="product-discount">-{{ product.discount }}%</span>
                                    {% else %}
                                        {{ product.price }} ‚ÇΩ
                                    {% endif %}
                                {% else %}
                                    –¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞
                                {% endif %}
                            {% endif %}
                        </div>
                        
                        <div class="product-meta">
                            {% if product.file_type %}
                                <div>–¢–∏–ø: {{ product.file_type.upper() }}</div>
                            {% endif %}
                            {% if product.bot_title %}
                                <div>–ë–æ—Ç: {{ product.bot_title }} (@{{ product.bot_username }})</div>
                            {% endif %}
                        </div>
                        
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-products">
                –ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
            </div>
        {% endif %}
    </div>

    <script src="/static/js/products.js"></script>
</body>
</html>
